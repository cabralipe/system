{% extends "atividade_multipla/base.html" %}

{% block page_title %}Nova Atividade{% endblock %}
{% block page_subtitle %}Crie uma nova atividade com múltiplas datas{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item active">Nova Atividade</li>
{% endblock %}

{% block page_actions %}
<a href="{{ url_for('atividade_multipla_routes.listar_atividades') }}" 
   class="btn btn-outline-secondary">
    <i class="fas fa-arrow-left me-2"></i>Voltar
</a>
{% endblock %}

{% block main_content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-plus-circle text-primary me-2"></i>
                    Criar Nova Atividade
                </h5>
            </div>
            
            <div class="card-body">
                <form method="POST" id="atividadeForm">
                    <!-- Informações Básicas -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary mb-3">
                                <i class="fas fa-info-circle me-2"></i>Informações Básicas
                            </h6>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <label for="titulo" class="form-label">Título da Atividade *</label>
                            <input type="text" class="form-control" id="titulo" name="titulo" required>
                        </div>
                        <div class="col-md-4">
                            <label for="tipo_atividade" class="form-label">Tipo de Atividade *</label>
                            <select class="form-select" id="tipo_atividade" name="tipo_atividade" required>
                                <option value="">Selecione...</option>
                                <option value="oficina">Oficina</option>
                                <option value="palestra">Palestra</option>
                                <option value="workshop">Workshop</option>
                                <option value="curso">Curso</option>
                                <option value="seminario">Seminário</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-12">
                            <label for="descricao" class="form-label">Descrição</label>
                            <textarea class="form-control" id="descricao" name="descricao" rows="3" 
                                      placeholder="Descreva a atividade..."></textarea>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <label for="carga_horaria_total" class="form-label">Carga Horária Total *</label>
                            <input type="number" class="form-control" id="carga_horaria_total" 
                                   name="carga_horaria_total" step="0.5" min="0" required>
                        </div>
                        <div class="col-md-3">
                            <label for="estado" class="form-label">Estado *</label>
                            <select class="form-select" id="estado" name="estado" required>
                                <option value="">Selecione...</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amapá</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Ceará</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Espírito Santo</option>
                                <option value="GO">Goiás</option>
                                <option value="MA">Maranhão</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Pará</option>
                                <option value="PB">Paraíba</option>
                                <option value="PR">Paraná</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piauí</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rondônia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">São Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="cidade" class="form-label">Cidade *</label>
                            <input type="text" class="form-control" id="cidade" name="cidade" required>
                        </div>
                        <div class="col-md-3">
                            <label for="evento_id" class="form-label">Evento (Opcional)</label>
                            <select class="form-select" id="evento_id" name="evento_id">
                                <option value="">Nenhum evento</option>
                                {% for evento in eventos %}
                                <option value="{{ evento.id }}">{{ evento.nome }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <!-- Configurações -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary mb-3">
                                <i class="fas fa-cog me-2"></i>Configurações
                            </h6>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permitir_checkin_multiplas_datas" 
                                       name="permitir_checkin_multiplas_datas" checked>
                                <label class="form-check-label" for="permitir_checkin_multiplas_datas">
                                    <strong>Permitir check-in em múltiplas datas</strong>
                                    <small class="d-block text-muted">
                                        Os participantes poderão fazer check-in em cada data da atividade
                                    </small>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="gerar_lista_frequencia" 
                                       name="gerar_lista_frequencia" checked>
                                <label class="form-check-label" for="gerar_lista_frequencia">
                                    <strong>Gerar lista de frequência</strong>
                                    <small class="d-block text-muted">
                                        Será gerada uma lista de frequência para cada data da atividade
                                    </small>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="exigir_presenca_todas_datas" 
                                       name="exigir_presenca_todas_datas">
                                <label class="form-check-label" for="exigir_presenca_todas_datas">
                                    <strong>Exigir presença em todas as datas</strong>
                                    <small class="d-block text-muted">
                                        O participante deve estar presente em todas as datas para receber certificado
                                    </small>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Datas da Atividade -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="text-primary mb-0">
                                    <i class="fas fa-calendar-day me-2"></i>Datas da Atividade
                                </h6>
                                <button type="button" class="add-data-btn" onclick="adicionarNovaData()">
                                    <i class="fas fa-plus me-2"></i>Adicionar Data
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="datas-container">
                        <!-- As datas serão adicionadas dinamicamente aqui -->
                    </div>
                    
                    <!-- Botões de Ação -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="d-flex justify-content-end gap-2">
                                <a href="{{ url_for('atividade_multipla_routes.listar_atividades') }}" 
                                   class="btn btn-outline-secondary">
                                    <i class="fas fa-times me-2"></i>Cancelar
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Salvar Atividade
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Adicionar primeira data automaticamente
    document.addEventListener('DOMContentLoaded', function() {
        adicionarNovaData();
    });
    
    // Validação do formulário
    document.getElementById('atividadeForm').addEventListener('submit', function(e) {
        const datas = document.querySelectorAll('input[name="datas[]"]');
        let hasValidData = false;
        
        datas.forEach(function(input) {
            if (input.value) {
                hasValidData = true;
            }
        });
        
        if (!hasValidData) {
            e.preventDefault();
            alert('Adicione pelo menos uma data para a atividade.');
            return false;
        }
        
        // Validar se todas as datas têm horários
        const horariosInicio = document.querySelectorAll('input[name="horarios_inicio[]"]');
        const horariosFim = document.querySelectorAll('input[name="horarios_fim[]"]');
        
        for (let i = 0; i < datas.length; i++) {
            if (datas[i].value && (!horariosInicio[i].value || !horariosFim[i].value)) {
                e.preventDefault();
                alert('Todas as datas devem ter horário de início e fim definidos.');
                return false;
            }
        }
    });
</script>
{% endblock %}
