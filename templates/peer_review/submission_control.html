{% extends 'base.html' %}
{% block title %}Controle de Submissões{% endblock %}
{% block content %}
<div class="container mt-5">
  <h3 class="mb-4">Controle de Submissões</h3>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Título</th>
        <th>Localizador</th>
        <th>Autor</th>
        <th>Revisores</th>
      </tr>
    </thead>
    <tbody>
      {% for sub in submissions %}
      <tr>
        <td>{{ sub.title }}</td>
        <td>{{ sub.locator }}</td>
        <td>{{ sub.author.nome if sub.author else 'N/A' }}</td>
        <td>
          <ul class="mb-0">
            {% for rev in sub.reviews %}
            <li>{{ rev.reviewer.nome if rev.reviewer else 'N/A' }} - {{ rev.access_code }}</li>
            {% else %}
            <li>Nenhum revisor atribuído</li>
            {% endfor %}
          </ul>
          <button class="btn btn-sm btn-secondary mt-1 gerar-codigos" data-locator="{{ sub.locator }}">Gerar Códigos</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="mt-5">
    <h4>Atribuir Revisores</h4>
    <div class="mb-3">
      <label for="submissionSelect" class="form-label">Submissão</label>
      <select id="submissionSelect" class="form-select">
        {% for sub in submissions %}
        <option value="{{ sub.id }}">{{ sub.title }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="mb-3">
      <label for="reviewerSelect" class="form-label">Revisores</label>
      <select id="reviewerSelect" class="form-select" multiple
              data-min="{{ config.num_revisores_min if config else 1 }}"
              data-max="{{ config.num_revisores_max if config else 2 }}">
        {% for r in reviewers %}
        <option value="{{ r.id }}">{{ r.nome }}</option>
        {% endfor %}
      </select>
      <small class="form-text text-muted">
        Selecione entre {{ config.num_revisores_min if config else 1 }} e {{ config.num_revisores_max if config else 2 }} revisores.
      </small>
    </div>
    <div class="row g-3 mb-3">
      <div class="col-md-4">
        <label for="filterArea" class="form-label">Área</label>
        <input type="text" id="filterArea" class="form-control" data-filter="area" placeholder="Ex.: Computação" />
      </div>
      <div class="col-md-4">
        <label for="filterNivel" class="form-label">Nível</label>
        <input type="text" id="filterNivel" class="form-control" data-filter="nivel" placeholder="Ex.: Doutorado" />
      </div>
    </div>
    <small class="form-text text-muted mb-3">
      Filtros disponíveis: área e nível. Deixe em branco para incluir todos os revisores.
    </small>
    <button id="assignManual" class="btn btn-primary me-2">Atribuir Manualmente</button>
    <button id="assignAutomatic" class="btn btn-secondary me-2" data-bs-toggle="tooltip" title="Sorteia revisores usando os filtros preenchidos">
      Sorteio Automático
    </button>
    <div class="input-group mt-2" style="max-width: 300px;">
      <input type="number" id="eventoId" class="form-control" placeholder="ID do Evento" />
      <button id="autoArea" class="btn btn-info">Auto por Área</button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/config_revisao.js') }}"></script>
{% endblock %}
