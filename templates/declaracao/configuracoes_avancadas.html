<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurações Avançadas - {{ template.nome }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .config-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }
        .config-item {
            margin-bottom: 15px;
        }
        .color-picker {
            width: 50px;
            height: 35px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .preview-box {
            border: 2px dashed #dee2e6;
            padding: 20px;
            text-align: center;
            background: #f8f9fa;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="fas fa-cogs"></i> Configurações Avançadas</h2>
                    <div>
                        <button type="button" class="btn btn-success" onclick="salvarConfiguracoes()">
                            <i class="fas fa-save"></i> Salvar Configurações
                        </button>
                        <a href="{{ url_for('declaracao.listar_templates') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Voltar
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8">
                <!-- Configurações de Layout -->
                <div class="config-section">
                    <h4><i class="fas fa-layout"></i> Layout e Dimensões</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="config-item">
                                <label class="form-label">Largura da Página (mm)</label>
                                <input type="number" class="form-control" id="pageWidth" value="{{ configuracoes.get('pageWidth', 210) }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="config-item">
                                <label class="form-label">Altura da Página (mm)</label>
                                <input type="number" class="form-control" id="pageHeight" value="{{ configuracoes.get('pageHeight', 297) }}">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="config-item">
                                <label class="form-label">Margem Superior (mm)</label>
                                <input type="number" class="form-control" id="marginTop" value="{{ configuracoes.get('marginTop', 20) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="config-item">
                                <label class="form-label">Margem Inferior (mm)</label>
                                <input type="number" class="form-control" id="marginBottom" value="{{ configuracoes.get('marginBottom', 20) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="config-item">
                                <label class="form-label">Margem Esquerda (mm)</label>
                                <input type="number" class="form-control" id="marginLeft" value="{{ configuracoes.get('marginLeft', 20) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="config-item">
                                <label class="form-label">Margem Direita (mm)</label>
                                <input type="number" class="form-control" id="marginRight" value="{{ configuracoes.get('marginRight', 20) }}">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configurações de Cores -->
                <div class="config-section">
                    <h4><i class="fas fa-palette"></i> Cores e Estilo</h4>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="config-item">
                                <label class="form-label">Cor de Fundo</label>
                                <div class="d-flex align-items-center">
                                    <input type="color" class="color-picker me-2" id="backgroundColor" value="{{ configuracoes.get('backgroundColor', '#ffffff') }}">
                                    <input type="text" class="form-control" id="backgroundColorText" value="{{ configuracoes.get('backgroundColor', '#ffffff') }}">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="config-item">
                                <label class="form-label">Cor do Texto Principal</label>
                                <div class="d-flex align-items-center">
                                    <input type="color" class="color-picker me-2" id="textColor" value="{{ configuracoes.get('textColor', '#000000') }}">
                                    <input type="text" class="form-control" id="textColorText" value="{{ configuracoes.get('textColor', '#000000') }}">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="config-item">
                                <label class="form-label">Cor de Destaque</label>
                                <div class="d-flex align-items-center">
                                    <input type="color" class="color-picker me-2" id="accentColor" value="{{ configuracoes.get('accentColor', '#007bff') }}">
                                    <input type="text" class="form-control" id="accentColorText" value="{{ configuracoes.get('accentColor', '#007bff') }}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configurações de Fonte -->
                <div class="config-section">
                    <h4><i class="fas fa-font"></i> Tipografia</h4>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="config-item">
                                <label class="form-label">Fonte Principal</label>
                                <select class="form-select" id="fontFamily">
                                    <option value="Arial" {{ 'selected' if configuracoes.get('fontFamily') == 'Arial' else '' }}>Arial</option>
                                    <option value="Times New Roman" {{ 'selected' if configuracoes.get('fontFamily') == 'Times New Roman' else '' }}>Times New Roman</option>
                                    <option value="Helvetica" {{ 'selected' if configuracoes.get('fontFamily') == 'Helvetica' else '' }}>Helvetica</option>
                                    <option value="Georgia" {{ 'selected' if configuracoes.get('fontFamily') == 'Georgia' else '' }}>Georgia</option>
                                    <option value="Verdana" {{ 'selected' if configuracoes.get('fontFamily') == 'Verdana' else '' }}>Verdana</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="config-item">
                                <label class="form-label">Tamanho Base da Fonte (px)</label>
                                <input type="number" class="form-control" id="baseFontSize" value="{{ configuracoes.get('baseFontSize', 14) }}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="config-item">
                                <label class="form-label">Altura da Linha</label>
                                <input type="number" step="0.1" class="form-control" id="lineHeight" value="{{ configuracoes.get('lineHeight', 1.5) }}">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configurações de Assinatura -->
                <div class="config-section">
                    <h4><i class="fas fa-signature"></i> Assinatura Digital</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="config-item">
                                <label class="form-label">Posição da Assinatura</label>
                                <select class="form-select" id="signaturePosition">
                                    <option value="bottom-center" {{ 'selected' if configuracoes.get('signaturePosition') == 'bottom-center' else '' }}>Centro Inferior</option>
                                    <option value="bottom-left" {{ 'selected' if configuracoes.get('signaturePosition') == 'bottom-left' else '' }}>Esquerda Inferior</option>
                                    <option value="bottom-right" {{ 'selected' if configuracoes.get('signaturePosition') == 'bottom-right' else '' }}>Direita Inferior</option>
                                    <option value="custom" {{ 'selected' if configuracoes.get('signaturePosition') == 'custom' else '' }}>Personalizada</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="config-item">
                                <label class="form-label">Tamanho da Assinatura (px)</label>
                                <input type="number" class="form-control" id="signatureSize" value="{{ configuracoes.get('signatureSize', 100) }}">
                            </div>
                        </div>
                    </div>
                    <div class="config-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="showSignatureLine" {{ 'checked' if configuracoes.get('showSignatureLine', true) else '' }}>
                            <label class="form-check-label" for="showSignatureLine">
                                Exibir linha para assinatura manual
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Configurações de QR Code -->
                <div class="config-section">
                    <h4><i class="fas fa-qrcode"></i> QR Code de Validação</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="config-item">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="enableQRCode" {{ 'checked' if configuracoes.get('enableQRCode', true) else '' }}>
                                    <label class="form-check-label" for="enableQRCode">
                                        Incluir QR Code para validação
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="config-item">
                                <label class="form-label">Tamanho do QR Code (px)</label>
                                <input type="number" class="form-control" id="qrCodeSize" value="{{ configuracoes.get('qrCodeSize', 80) }}">
                            </div>
                        </div>
                    </div>
                    <div class="config-item">
                        <label class="form-label">Posição do QR Code</label>
                        <select class="form-select" id="qrCodePosition">
                            <option value="bottom-right" {{ 'selected' if configuracoes.get('qrCodePosition') == 'bottom-right' else '' }}>Canto Inferior Direito</option>
                            <option value="bottom-left" {{ 'selected' if configuracoes.get('qrCodePosition') == 'bottom-left' else '' }}>Canto Inferior Esquerdo</option>
                            <option value="top-right" {{ 'selected' if configuracoes.get('qrCodePosition') == 'top-right' else '' }}>Canto Superior Direito</option>
                            <option value="top-left" {{ 'selected' if configuracoes.get('qrCodePosition') == 'top-left' else '' }}>Canto Superior Esquerdo</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <!-- Preview -->
                <div class="config-section">
                    <h4><i class="fas fa-eye"></i> Preview</h4>
                    <div class="preview-box" id="previewBox">
                        <p class="text-muted">Preview das configurações será exibido aqui</p>
                        <button type="button" class="btn btn-primary" onclick="atualizarPreview()">
                            <i class="fas fa-refresh"></i> Atualizar Preview
                        </button>
                    </div>
                </div>

                <!-- Informações do Template -->
                <div class="config-section">
                    <h4><i class="fas fa-info-circle"></i> Informações</h4>
                    <p><strong>Template:</strong> {{ template.nome }}</p>
                    <p><strong>Tipo:</strong> {{ template.tipo|title }}</p>
                    <p><strong>Criado em:</strong> {{ template.data_criacao.strftime('%d/%m/%Y') if template.data_criacao else 'N/A' }}</p>
                    <p><strong>Status:</strong> 
                        <span class="badge {{ 'bg-success' if template.ativo else 'bg-secondary' }}">
                            {{ 'Ativo' if template.ativo else 'Inativo' }}
                        </span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sincronizar color pickers com inputs de texto
        document.getElementById('backgroundColor').addEventListener('change', function() {
            document.getElementById('backgroundColorText').value = this.value;
        });
        
        document.getElementById('textColor').addEventListener('change', function() {
            document.getElementById('textColorText').value = this.value;
        });
        
        document.getElementById('accentColor').addEventListener('change', function() {
            document.getElementById('accentColorText').value = this.value;
        });
        
        // Sincronizar inputs de texto com color pickers
        document.getElementById('backgroundColorText').addEventListener('change', function() {
            document.getElementById('backgroundColor').value = this.value;
        });
        
        document.getElementById('textColorText').addEventListener('change', function() {
            document.getElementById('textColor').value = this.value;
        });
        
        document.getElementById('accentColorText').addEventListener('change', function() {
            document.getElementById('accentColor').value = this.value;
        });

        function coletarConfiguracoes() {
            return {
                pageWidth: parseInt(document.getElementById('pageWidth').value),
                pageHeight: parseInt(document.getElementById('pageHeight').value),
                marginTop: parseInt(document.getElementById('marginTop').value),
                marginBottom: parseInt(document.getElementById('marginBottom').value),
                marginLeft: parseInt(document.getElementById('marginLeft').value),
                marginRight: parseInt(document.getElementById('marginRight').value),
                backgroundColor: document.getElementById('backgroundColor').value,
                textColor: document.getElementById('textColor').value,
                accentColor: document.getElementById('accentColor').value,
                fontFamily: document.getElementById('fontFamily').value,
                baseFontSize: parseInt(document.getElementById('baseFontSize').value),
                lineHeight: parseFloat(document.getElementById('lineHeight').value),
                signaturePosition: document.getElementById('signaturePosition').value,
                signatureSize: parseInt(document.getElementById('signatureSize').value),
                showSignatureLine: document.getElementById('showSignatureLine').checked,
                enableQRCode: document.getElementById('enableQRCode').checked,
                qrCodeSize: parseInt(document.getElementById('qrCodeSize').value),
                qrCodePosition: document.getElementById('qrCodePosition').value
            };
        }

        function salvarConfiguracoes() {
            const configuracoes = coletarConfiguracoes();
            
            fetch(`{{ url_for('declaracao.salvar_configuracoes', template_id=template.id) }}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ configuracoes: configuracoes })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Configurações salvas com sucesso!');
                } else {
                    alert('Erro ao salvar configurações: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao salvar configurações.');
            });
        }

        function atualizarPreview() {
            const configuracoes = coletarConfiguracoes();
            const previewBox = document.getElementById('previewBox');
            
            previewBox.innerHTML = `
                <div style="
                    background-color: ${configuracoes.backgroundColor};
                    color: ${configuracoes.textColor};
                    font-family: ${configuracoes.fontFamily};
                    font-size: ${configuracoes.baseFontSize}px;
                    line-height: ${configuracoes.lineHeight};
                    padding: 20px;
                    border-radius: 4px;
                    text-align: center;
                ">
                    <h5 style="color: ${configuracoes.accentColor}; margin-bottom: 15px;">DECLARAÇÃO</h5>
                    <p style="margin-bottom: 10px;">Declaramos que [NOME_PARTICIPANTE]</p>
                    <p style="margin-bottom: 10px;">participou do evento [NOME_EVENTO]</p>
                    <p style="margin-bottom: 15px;">com carga horária de [CARGA_HORARIA] horas.</p>
                    ${configuracoes.showSignatureLine ? '<div style="border-top: 1px solid #000; width: 200px; margin: 20px auto;"></div>' : ''}
                    ${configuracoes.enableQRCode ? `<div style="width: ${configuracoes.qrCodeSize}px; height: ${configuracoes.qrCodeSize}px; background: #ddd; margin: 10px auto; display: flex; align-items: center; justify-content: center; font-size: 10px;">QR Code</div>` : ''}
                </div>
            `;
        }

        // Atualizar preview inicial
        document.addEventListener('DOMContentLoaded', function() {
            atualizarPreview();
        });
    </script>
</body>
</html>