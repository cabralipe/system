{% extends "base.html" %}
{% block title %}Esqueci Minha Senha{% endblock %}

{% block content %}
<div class="page-container">
  <div class="forgot-password-card">
    <div class="card-header-custom">
      <div class="header-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z" />
        </svg>
      </div>
      <h2>Recuperar Acesso</h2>
      <p class="subtitle">Insira seu CPF para iniciar a redefinição de senha.</p>
    </div>
    <div class="card-body-custom">
      <form method="POST" id="recuperarSenhaForm" novalidate>
        <div class="form-group-custom">
          <label for="cpf">CPF</label>
          <div class="input-wrapper">
            <input type="text" id="cpf" name="cpf" class="form-control-custom" placeholder="000.000.000-00" required>
            <i class="input-icon" id="cpfIcon"></i>
          </div>
          <div class="feedback-message" id="cpfFeedback"></div>
        </div>
        <div class="d-grid">
          <button type="submit" class="btn-submit" id="btnSubmit">
            <span>Verificar CPF</span>
            <div class="spinner-border spinner-border-sm ms-2 d-none" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </button>
        </div>
      </form>
    </div>
    <div class="card-footer-custom">
      <a href="#">Lembrou a senha? Voltar ao Login</a>
    </div>
  </div>
</div>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

  :root {
    --primary-color: #6c5ce7;
    --primary-hover: #5b4ce0;
    --success-color: #1dd1a1;
    --error-color: #ff6b6b;
    --text-color: #333;
    --light-text-color: #f1f2f6;
    --muted-color: #a4b0be;
    --bg-gradient: linear-gradient(120deg, #a6c0fe 0%, #f68084 100%);
  }

  body, html {
    height: 100%;
    margin: 0;
  }
  
  .page-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background: #f1f2f6;  /* Fundo sólido */
    font-family: 'Poppins', sans-serif;
    padding: 2rem;
  }

  .forgot-password-card {
    width: 100%;
    max-width: 420px;
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .forgot-password-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
  }

  .card-header-custom {
    text-align: center;
    padding: 30px 30px 20px;
  }
  
  .header-icon {
    margin: 0 auto 1rem;
    width: 60px;
    height: 60px;
    background: var(--primary-color);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
  }

  .header-icon svg {
    width: 30px;
    height: 30px;
  }

  .card-header-custom h2 {
    font-weight: 600;
    color: var(--text-color);
    margin: 0;
  }
  
  .card-header-custom .subtitle {
    color: #57606f;
    font-size: 0.95rem;
  }

  .card-body-custom {
    padding: 20px 35px;
  }

  .form-group-custom {
    margin-bottom: 1.5rem;
  }

  .form-group-custom label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: var(--text-color);
    font-size: 0.9rem;
  }

  .input-wrapper {
    position: relative;
  }
  
  .form-control-custom {
    width: 100%;
    padding: 12px 40px 12px 16px;
    border: 1px solid #ced4da;
    border-radius: 10px;
    font-size: 1rem;
    transition: border-color 0.3s, box-shadow 0.3s;
    background-color: rgba(255, 255, 255, 0.8);
    color: #333;  /* Texto negro */
  }
  
  .form-control-custom:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 4px rgba(108, 92, 231, 0.2);
  }

  /* Validation styles */
  .form-control-custom.is-valid {
    border-color: var(--success-color);
  }
  .form-control-custom.is-valid:focus {
    box-shadow: 0 0 0 4px rgba(29, 209, 161, 0.25);
  }
  .form-control-custom.is-invalid {
    border-color: var(--error-color);
  }
  .form-control-custom.is-invalid:focus {
    box-shadow: 0 0 0 4px rgba(255, 107, 107, 0.25);
  }

  .input-icon {
    position: absolute;
    top: 50%;
    right: 15px;
    transform: translateY(-50%);
    font-style: normal;
    transition: color 0.3s;
  }
  
  .input-icon.valid { color: var(--success-color); }
  .input-icon.invalid { color: var(--error-color); }

  .feedback-message {
    font-size: 0.8rem;
    margin-top: 0.5rem;
    height: 1rem;
    font-weight: 500;
    transition: color 0.3s;
  }
  
  .feedback-message.valid { color: var(--success-color); }
  .feedback-message.invalid { color: var(--error-color); }

  .btn-submit {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: 14px;
    font-size: 1rem;
    font-weight: 600;
    color: var(--light-text-color);
    background: var(--primary-color);
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s, box-shadow 0.2s;
  }
  
  .btn-submit:hover {
    background-color: var(--primary-hover);
    transform: translateY(-2px);
    box-shadow: 0 7px 20px rgba(91, 76, 224, 0.3);
  }

  .btn-submit:active {
    transform: translateY(0);
  }

  .card-footer-custom {
    padding: 20px;
    background-color: rgba(0,0,0,0.03);
    text-align: center;
  }
  
  .card-footer-custom a {
    color: #57606f;
    text-decoration: none;
    font-size: 0.9rem;
    transition: color 0.3s;
  }
  
  .card-footer-custom a:hover {
    color: var(--primary-color);
    text-decoration: underline;
  }

</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const cpfInput = document.getElementById('cpf');
  const cpfFeedback = document.getElementById('cpfFeedback');
  const cpfIcon = document.getElementById('cpfIcon');
  const form = document.getElementById('recuperarSenhaForm');

  cpfInput.addEventListener('input', (e) => {
    let value = e.target.value.replace(/\D/g, '');
    value = value.replace(/(\d{3})(\d)/, '$1.$2');
    value = value.replace(/(\d{3})(\d)/, '$1.$2');
    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
    e.target.value = value;
    
    // Clear validation on input
    clearValidation();
    if (value.length === 14) {
      validateAndStyleCPF(value);
    }
  });

  function validateAndStyleCPF(cpf) {
    if (isValidCPF(cpf)) {
      setValid('CPF válido.');
    } else {
      setInvalid('CPF inválido, verifique os dígitos.');
    }
  }

  function isValidCPF(cpf) {
    cpf = cpf.replace(/\D/g, '');
    if (cpf.length !== 11 || /^(\d)\1+$/.test(cpf)) return false;

    let sum = 0;
    let remainder;

    for (let i = 1; i <= 9; i++) {
        sum += parseInt(cpf.substring(i - 1, i)) * (11 - i);
    }
    remainder = (sum * 10) % 11;
    if ((remainder === 10) || (remainder === 11)) remainder = 0;
    if (remainder !== parseInt(cpf.substring(9, 10))) return false;

    sum = 0;
    for (let i = 1; i <= 10; i++) {
        sum += parseInt(cpf.substring(i - 1, i)) * (12 - i);
    }
    remainder = (sum * 10) % 11;
    if ((remainder === 10) || (remainder === 11)) remainder = 0;
    if (remainder !== parseInt(cpf.substring(10, 11))) return false;

    return true;
  }

  function setValid(message) {
    cpfInput.classList.add('is-valid');
    cpfInput.classList.remove('is-invalid');
    cpfFeedback.textContent = message;
    cpfFeedback.className = 'feedback-message valid';
    cpfIcon.textContent = '✓';
    cpfIcon.className = 'input-icon valid';
  }

  function setInvalid(message) {
    cpfInput.classList.remove('is-valid');
    cpfInput.classList.add('is-invalid');
    cpfFeedback.textContent = message;
    cpfFeedback.className = 'feedback-message invalid';
    cpfIcon.textContent = '✕';
    cpfIcon.className = 'input-icon invalid';
  }

  function clearValidation() {
    cpfInput.classList.remove('is-valid', 'is-invalid');
    cpfFeedback.textContent = '';
    cpfFeedback.className = 'feedback-message';
    cpfIcon.textContent = '';
  }

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    if (isValidCPF(cpfInput.value)) {
      // Aqui você adicionaria a lógica para enviar o formulário
      console.log('Formulário enviado com CPF válido.');
      alert('Um link para redefinição de senha foi enviado para o seu e-mail.');
    } else {
      setInvalid('Por favor, insira um CPF válido para continuar.');
    }
  });
});
</script>
{% endblock %}