{% extends "base.html" %}
{% block content %}
<div class="container">
    <h2>Respostas - {{ formulario.nome }}</h2>

    {% if respostas %}
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>UsuÃ¡rio</th>
                <th>Data de Envio</th>
                <th>Status</th>
                <th>AÃ§Ãµes</th>
            </tr>
        </thead>
        <tbody>
            {% for resposta in respostas %}
            <tr>
                <td>{{ resposta.usuario.nome }}</td>
                <td>{{ resposta.data_submissao.strftime('%d/%m/%Y %H:%M') }}</td>

                <!-- Coluna do STATUS (com form inline) -->
                <td>
                  <form method="POST" action="{{ url_for('routes.definir_status_inline') }}"
                        class="d-flex align-items-center">
                    
                    <!-- O ID da resposta (oculto) -->
                    <input type="hidden" name="resposta_id" value="{{ resposta.id }}">

                    <!-- Selecione o status -->
                    <select name="status_avaliacao" class="form-select form-select-sm me-2">
                      <option value="NÃ£o Avaliada"
                        {% if resposta.status_avaliacao == 'NÃ£o Avaliada' %} selected {% endif %}>
                        NÃ£o Avaliada
                      </option>
                      <option value="Aprovada"
                        {% if resposta.status_avaliacao == 'Aprovada' %} selected {% endif %}>
                        Aprovada
                      </option>
                      <option value="Aprovada com ressalvas"
                        {% if resposta.status_avaliacao == 'Aprovada com ressalvas' %} selected {% endif %}>
                        Aprovada com ressalvas
                      </option>
                      <option value="Aprovada para pÃ´ster"
                        {% if resposta.status_avaliacao == 'Aprovada para pÃ´ster' %} selected {% endif %}>
                        Aprovada para pÃ´ster
                      </option>
                      <option value="Aprovada para apresentaÃ§Ã£o oral"
                        {% if resposta.status_avaliacao == 'Aprovada para apresentaÃ§Ã£o oral' %} selected {% endif %}>
                        Aprovada para apresentaÃ§Ã£o oral
                      </option>
                      <option value="Negada"
                        {% if resposta.status_avaliacao == 'Negada' %} selected {% endif %}>
                        Negada
                      </option>
                    </select>

                    <!-- BotÃ£o Salvar -->
                    <button type="submit" class="btn btn-sm btn-primary">
                      Salvar
                    </button>
                  </form>
                </td>

                <!-- AÃ§Ãµes (Ver Detalhes / Dar Feedback) -->
                <td>
                    <!-- BotÃ£o: Ver Detalhes -->
                    <a href="{{ url_for('routes.visualizar_resposta', resposta_id=resposta.id) }}"
                       class="btn btn-info btn-sm mb-1">
                       Ver Detalhes
                    </a>
                    
                    <!-- BotÃ£o: Dar Feedback -->
                    <a href="{{ url_for('routes.dar_feedback_resposta', resposta_id=resposta.id) }}"
                       class="btn btn-primary btn-sm">
                       Ver Respostas / Dar Feedback
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
      <p class="text-warning">Nenhuma resposta enviada ainda.</p>
    {% endif %}

    <div class="mt-4">
        <a href="{{ url_for('routes.gerar_pdf_respostas', formulario_id=formulario.id) }}"
           class="btn btn-primary">
           ðŸ“„ Exportar PDF
        </a>
        <a href="{{ url_for('routes.exportar_csv', formulario_id=formulario.id) }}"
           class="btn btn-success">
           ðŸ“Š Exportar CSV
        </a>
    </div>

    <a href="{{ url_for('routes.dashboard') }}" class="btn btn-secondary mt-3">Voltar</a>
</div>
{% endblock %}
