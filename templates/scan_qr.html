{% extends "base.html" %}

{% block title %}Escanear QR Code{% endblock %}

{% block content %}
<div class="container d-flex flex-column justify-content-center align-items-center" style="min-height: 80vh;">
    <h2 class="mb-4">Escanear QR Code</h2>
    <!-- Área ampliada para o scanner -->
    <div id="qr-video" style="width:600px; height:500px;"></div>
    <p id="qr-result" class="mt-4"></p>
    <a href="{{ url_for('routes.dashboard') }}" class="btn btn-secondary mt-3">Voltar</a>
</div>

<!-- Biblioteca para leitura de QR Code -->
<script src="https://unpkg.com/html5-qrcode"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const scanner = new Html5Qrcode("qr-video");

    function onScanSuccess(decodedText) {
        document.getElementById("qr-result").innerHTML = `<strong>QR Code Lido:</strong> ${decodedText}`;
        // Redireciona automaticamente para a URL lida
        window.location.href = decodedText;
    }

    function onScanError(errorMessage) {
        console.warn("Erro ao escanear:", errorMessage);
    }

    // Inicia o scanner com uma caixa de leitura de 500x500 e 10 FPS
    scanner.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: { width: 500, height: 500 } },
        onScanSuccess,
        onScanError
    ).catch(err => {
        console.error("Falha ao iniciar o scanner:", err);
    });
});
</script>
{% endblock %}
