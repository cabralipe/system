{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
  <h3 class="mb-4">Submissão de Trabalho Científico</h3>
  <form method="POST" enctype="multipart/form-data">
    {% if csrf_token is defined %}
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    {% endif %}
    {% set tipos = current_user.cliente.configuracao.allowed_file_types if current_user.cliente and current_user.cliente.configuracao else 'pdf' %}
    {% set accept_str = '.' + tipos.replace(',', ',.').replace(' ', '') %}
    {% for campo in formulario.campos %}
      <div class="mb-3">
        <label class="form-label">{{ campo.nome }}</label>
        {% if campo.tipo == 'textarea' %}
          <textarea class="form-control" name="{{ campo.id }}" rows="4" {% if campo.obrigatorio %}required{% endif %}{% if campo.tamanho_max %} maxlength="{{ campo.tamanho_max }}"{% endif %}></textarea>
        {% elif campo.tipo == 'file' %}
          <input type="file" class="form-control" name="file_{{ campo.id }}" {% if campo.obrigatorio %}required{% endif %} accept="{{ accept_str }}">
        {% elif campo.tipo == 'select' %}
          <select class="form-select" name="{{ campo.id }}" {% if campo.obrigatorio %}required{% endif %}>
            {% for opt in campo.opcoes.split(',') if campo.opcoes %}
              <option value="{{ opt.strip() }}">{{ opt.strip() }}</option>
            {% endfor %}
          </select>
        {% else %}
          <input type="{{ campo.tipo }}" class="form-control" name="{{ campo.id }}" {% if campo.obrigatorio %}required{% endif %}{% if campo.tamanho_max %} maxlength="{{ campo.tamanho_max }}"{% endif %}>
        {% endif %}
        {% if campo.descricao %}
          <small class="form-text text-muted">{{ campo.descricao }}</small>
        {% endif %}
      </div>
    {% endfor %}
    <button type="submit" class="btn btn-success">
      <i class="bi bi-upload me-2"></i>Submeter Trabalho
    </button>
  </form>
</div>
{% endblock %}
