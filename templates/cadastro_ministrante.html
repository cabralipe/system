{% extends "base.html" %}
{% block title %}Cadastro de Participante{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="card shadow-sm border-0 overflow-hidden">
        <div class="card-header bg-primary text-white p-3">
          <div class="d-flex align-items-center">
            <i class="bi bi-person-plus-fill fs-3 me-3"></i>
            <h2 class="mb-0 fw-bold">Cadastro de Participante</h2>
          </div>
          <p class="mb-0 mt-2 text-white-50">Preencha os dados abaixo para se cadastrar no sistema</p>
        </div>
        
        <div class="card-body p-4">
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show mb-4" role="alert">
                  <div class="d-flex align-items-center">
                    {% if category == 'success' %}
                      <i class="bi bi-check-circle-fill me-2 fs-5"></i>
                    {% elif category == 'danger' %}
                      <i class="bi bi-exclamation-triangle-fill me-2 fs-5"></i>
                    {% else %}
                      <i class="bi bi-info-circle-fill me-2 fs-5"></i>
                    {% endif %}
                    <div>{{ message }}</div>
                  </div>
                  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
              {% endfor %}
            {% endif %}
          {% endwith %}

          <form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
            <div class="row g-4">
              <!-- Seção de Informações Pessoais -->
              <div class="col-12">
                <h5 class="text-primary border-bottom pb-2 mb-3">
                  <i class="bi bi-person-badge me-2"></i>Informações Pessoais
                </h5>
              </div>
              
              <div class="col-md-8">
                <div class="form-floating mb-3">
                  <input type="text" class="form-control" id="nome" name="nome" placeholder="Nome Completo" required>
                  <label for="nome"><i class="bi bi-person me-2"></i>Nome Completo</label>
                  <div class="invalid-feedback">Por favor, informe seu nome completo.</div>
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="foto" class="form-label fw-medium mb-2">Foto de Perfil:</label>
                  <input type="file" class="form-control" id="foto" name="foto" accept="image/*">
                  <div class="form-text">Imagem de perfil (opcional)</div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="form-floating mb-3">
                  <input type="text" class="form-control" id="cpf" name="cpf" placeholder="000.000.000-00" required>
                  <label for="cpf"><i class="bi bi-card-text me-2"></i>CPF</label>
                  <div class="invalid-feedback">Por favor, informe um CPF válido.</div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="form-floating mb-3">
                  <input type="text" class="form-control" id="pix" name="pix" placeholder="Chave PIX" required>
                  <label for="pix"><i class="bi bi-cash me-2"></i>PIX</label>
                  <div class="invalid-feedback">Por favor, informe sua chave PIX.</div>
                </div>
              </div>
              
              <!-- Seção de Formação -->
              <div class="col-12">
                <h5 class="text-primary border-bottom pb-2 mb-3 mt-2">
                  <i class="bi bi-mortarboard-fill me-2"></i>Formação e Áreas
                </h5>
              </div>
              
              <div class="col-md-6">
                <label for="categorias_formacao" class="form-label fw-medium mb-2">Categorias de Formação Acadêmica:</label>
                <select multiple class="form-select form-select-lg" id="categorias_formacao" name="categorias_formacao" style="height: 150px;">
                  {% for categoria in [
                    "Bacharelado", "Licenciatura", "Tecnólogo",
                    "Especialização", "MBA", "Mestrado", "Doutorado",
                    "Curso Técnico", "Curso Profissionalizante", "Curso Sequencial"
                  ] %}
                    <option value="{{ categoria }}">{{ categoria }}</option>
                  {% endfor %}
                </select>
                <div class="form-text">Segure Ctrl para selecionar múltiplas opções</div>
              </div>
              
              <div class="col-md-6">
                <div class="mb-3 h-100">
                  <label for="formacao" class="form-label fw-medium mb-2">Observações da Formação:</label>
                  <textarea class="form-control h-75" id="formacao" name="formacao" placeholder="Detalhes sobre sua formação acadêmica"></textarea>
                  <div class="form-text">Informações adicionais (opcional)</div>
                </div>
              </div>
              
              <div class="col-12">
                <div class="form-floating mb-3">
                  <input type="text" class="form-control" id="areas" name="areas" placeholder="Áreas de Atuação" required>
                  <label for="areas"><i class="bi bi-briefcase me-2"></i>Áreas de Atuação</label>
                  <div class="form-text">Separe as áreas por vírgula (ex: Desenvolvimento Web, UX/UI, Marketing Digital)</div>
                  <div class="invalid-feedback">Por favor, informe pelo menos uma área de atuação.</div>
                </div>
              </div>
              
              <!-- Seção de Localização -->
              <div class="col-12">
                <h5 class="text-primary border-bottom pb-2 mb-3 mt-2">
                  <i class="bi bi-geo-alt-fill me-2"></i>Localização
                </h5>
              </div>
              
              <div class="col-md-6">
                <div class="form-floating mb-3">
                  <select class="form-select" id="estado" name="estado" required>
                    <option value="">Selecione o Estado</option>
                  </select>
                  <label for="estado"><i class="bi bi-map me-2"></i>Estado</label>
                  <div class="invalid-feedback">Por favor, selecione um estado.</div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="form-floating mb-3">
                  <select class="form-select" id="cidade" name="cidade" required>
                    <option value="">Selecione o Estado primeiro</option>
                  </select>
                  <label for="cidade"><i class="bi bi-building me-2"></i>Cidade</label>
                  <div class="invalid-feedback">Por favor, selecione uma cidade.</div>
                </div>
              </div>
              
              <!-- Seção de Acesso -->
              <div class="col-12">
                <h5 class="text-primary border-bottom pb-2 mb-3 mt-2">
                  <i class="bi bi-shield-lock-fill me-2"></i>Dados de Acesso
                </h5>
              </div>
              
              <div class="col-md-6">
                <div class="form-floating mb-3">
                  <input type="email" class="form-control" id="email" name="email" placeholder="nome@exemplo.com" required>
                  <label for="email"><i class="bi bi-envelope me-2"></i>E-mail</label>
                  <div class="invalid-feedback">Por favor, informe um e-mail válido.</div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="form-floating mb-3">
                  <input type="password" class="form-control" id="senha" name="senha" placeholder="Senha" required>
                  <label for="senha"><i class="bi bi-key me-2"></i>Senha</label>
                  <div class="form-text">Mínimo de 8 caracteres, incluindo letras e números</div>
                  <div class="invalid-feedback">Por favor, crie uma senha segura.</div>
                </div>
              </div>
              
              <!-- Botões de Ação -->
              <div class="col-12 mt-4">
                <div class="d-grid gap-2">
                  <button type="submit" class="btn btn-primary btn-lg">
                    <i class="bi bi-check-circle me-2"></i>Finalizar Cadastro
                  </button>
                  <a href="{{ url_for('routes.login') }}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-2"></i>Voltar para Login
                  </a>
                </div>
              </div>
            </div>
          </form>
        </div>
        
        <div class="card-footer bg-light p-3">
          <div class="d-flex align-items-center text-muted">
            <i class="bi bi-shield-check me-2"></i>
            <small>Seus dados estão protegidos e não serão compartilhados com terceiros.</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Form validation
  (function() {
    'use strict';
    window.addEventListener('load', function() {
      var forms = document.getElementsByClassName('needs-validation');
      Array.prototype.filter.call(forms, function(form) {
        form.addEventListener('submit', function(event) {
          if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    }, false);
  })();

  // Estados e cidades
  document.addEventListener("DOMContentLoaded", function() {
    fetch('https://servicodados.ibge.gov.br/api/v1/localidades/estados')
      .then(response => response.json())
      .then(data => {
        data.sort((a, b) => a.nome.localeCompare(b.nome));
        const estadoSelect = document.getElementById('estado');
        data.forEach(uf => {
          estadoSelect.add(new Option(uf.nome, uf.sigla));
        });
      });

    document.getElementById('estado').addEventListener('change', function() {
      const uf = this.value;
      fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${uf}/municipios`)
        .then(response => response.json())
        .then(cities => {
          const cidadeSelect = document.getElementById('cidade');
          cidadeSelect.innerHTML = '<option value="">Selecione uma cidade</option>';
          cities.sort((a, b) => a.nome.localeCompare(b.nome));
          cities.forEach(city => {
            cidadeSelect.add(new Option(city.nome, city.nome));
          });
        });
    });
    
    // Máscara para CPF
    const cpfInput = document.getElementById('cpf');
    cpfInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 11) value = value.slice(0, 11);
      
      if (value.length > 9) {
        value = value.replace(/^(\d{3})(\d{3})(\d{3})(\d{2})$/, "$1.$2.$3-$4");
      } else if (value.length > 6) {
        value = value.replace(/^(\d{3})(\d{3})(\d{1,3})$/, "$1.$2.$3");
      } else if (value.length > 3) {
        value = value.replace(/^(\d{3})(\d{1,3})$/, "$1.$2");
      }
      
      e.target.value = value;
    });
  });
</script>
{% endblock %}