<!-- Template: emails/cancelamento_agendamento.html -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Confirmação de Cancelamento</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 600px;
            margin: 0 auto;
        }
        .container {
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .header {
            background-color: #dc3545;
            color: white;
            padding: 10px 20px;
            text-align: center;
            border-radius: 5px 5px 0 0;
        }
        .footer {
            background-color: #f5f5f5;
            padding: 10px 20px;
            text-align: center;
            font-size: 0.8em;
            color: #777;
            border-radius: 0 0 5px 5px;
        }
        .info-block {
            background-color: #f9f9f9;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Confirmação de Cancelamento</h1>
        </div>
        
        <p>Olá, {{ professor.nome }}!</p>
        
        <p>Seu agendamento para visitação ao evento <strong>{{ evento.nome }}</strong> foi cancelado conforme solicitado.</p>
        
        <div class="info-block">
            <h3>Detalhes do Agendamento Cancelado:</h3>
            <p><strong>Código do Agendamento:</strong> #{{ agendamento.id }}</p>
            <p><strong>Data:</strong> {{ horario.data.strftime('%d/%m/%Y') }}</p>
            <p><strong>Horário:</strong> {{ horario.horario_inicio.strftime('%H:%M') }} às {{ horario.horario_fim.strftime('%H:%M') }}</p>
            <p><strong>Local:</strong> {{ evento.local }}</p>
            <p><strong>Escola:</strong> {{ agendamento.escola_nome }}</p>
            <p><strong>Turma:</strong> {{ agendamento.turma }}</p>
            <p><strong>Data do Cancelamento:</strong> {{ agendamento.data_cancelamento.strftime('%d/%m/%Y %H:%M') }}</p>
        </div>
        
        {% set config = evento.configuracoes_agendamento[0] if evento.configuracoes_agendamento else None %}
        {% if config %}
            {% set data_hora_visita = horario.data|string + ' ' + horario.horario_inicio|string %}
            {% set data_hora_visita = data_hora_visita|to_datetime %}
            {% set prazo_limite = data_hora_visita - config.prazo_cancelamento|timedelta(hours=true) %}
            {% set data_cancelamento = agendamento.data_cancelamento %}
            
            {% if data_cancelamento > prazo_limite %}
                <div style="background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 10px; border-radius: 5px; margin: 15px 0;">
                    <p><strong>Aviso de Bloqueio:</strong> Seu cancelamento foi realizado fora do prazo estipulado ({{ config.prazo_cancelamento }} horas antes da visita).</p>
                    <p>De acordo com as regras do evento, você está temporariamente bloqueado para novos agendamentos neste evento por {{ config.tempo_bloqueio }} dias.</p>
                </div>
            {% endif %}
        {% endif %}
        
        <p>Caso queira agendar uma nova visita, você pode fazê-lo através do sistema.</p>
        
        <center>
            <a href="{{ url_for('routes.eventos_disponiveis_professor', _external=True) }}" class="btn">Ver Eventos Disponíveis</a>
        </center>
        
        <div class="footer">
            <p>Este é um e-mail automático. Por favor, não responda a esta mensagem.</p>
            <p>&copy; {{ now().year }} {{ evento.cliente.nome }} - Todos os direitos reservados.</p>
        </div>
    </div>
</body>
</html>
