{% extends "base.html" %}

{% block title %}Editor Avançado de Certificado{% endblock %}

{% block extra_css %}
<link href="{{ url_for('static', filename='css/certificate-editor.css') }}" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
{% endblock %}

{% block content %}
<div class="editor-container">
  <!-- Toolbar -->
  <div class="toolbar">
    <div class="toolbar-group">
      <button type="button" class="btn btn-primary" id="saveTemplate">
        <i class="fas fa-save me-1"></i> Salvar
      </button>
      <button type="button" class="btn btn-outline-primary" id="previewTemplate">
        <i class="fas fa-eye me-1"></i> Preview
      </button>
      <button type="button" class="btn btn-outline-secondary" id="livePreviewToggle">
        <i class="fas fa-play me-1"></i> Preview Dinâmico
      </button>
      <button type="button" class="btn btn-outline-success" id="exportTemplate">
        <i class="fas fa-download me-1"></i> Exportar
      </button>
    </div>
    
    <div class="toolbar-group">
      <button type="button" class="btn btn-outline-secondary" id="undoAction">
        <i class="fas fa-undo me-1"></i> Desfazer
      </button>
      <button type="button" class="btn btn-outline-secondary" id="redoAction">
        <i class="fas fa-redo me-1"></i> Refazer
      </button>
    </div>
    
    <div class="toolbar-group">
      <button type="button" class="btn btn-outline-secondary" id="toggleGrid">
        <i class="fas fa-th me-1"></i> Grade
      </button>
      <button type="button" class="btn btn-outline-secondary" id="toggleSnap">
        <i class="fas fa-magnet me-1"></i> Ímã
      </button>
    </div>
    
    <div class="toolbar-group">
      <label for="zoomLevel" class="form-label me-2 mb-0">Zoom:</label>
      <select class="form-select form-select-sm" id="zoomLevel" style="width: auto;">
        <option value="0.5">50%</option>
        <option value="0.75">75%</option>
        <option value="1" selected>100%</option>
        <option value="1.25">125%</option>
        <option value="1.5">150%</option>
        <option value="2">200%</option>
      </select>
    </div>
  </div>

  <!-- Workspace -->
  <div class="workspace">
    <!-- Sidebar da biblioteca de elementos -->
    <div class="elements-sidebar">
      <div class="sidebar-header">
        <i class="fas fa-layer-group me-2"></i>
        Biblioteca de Elementos
      </div>
      
      <div class="elements-library">
        <!-- Elementos básicos -->
        <div class="element-category">
          <div class="category-title">Elementos Básicos</div>
          
          <div class="element-item" data-type="text">
            <i class="fas fa-font me-2"></i>
            <div>
              <strong>Texto</strong>
              <small class="d-block text-muted">Adicionar texto personalizado</small>
            </div>
          </div>
          
          <div class="element-item" data-type="logo">
            <i class="fas fa-image me-2"></i>
            <div>
              <strong>Logo</strong>
              <small class="d-block text-muted">Inserir logotipo</small>
            </div>
          </div>
          
          <div class="element-item" data-type="signature">
            <i class="fas fa-signature me-2"></i>
            <div>
              <strong>Assinatura</strong>
              <small class="d-block text-muted">Campo para assinatura</small>
            </div>
          </div>
          
          <div class="element-item" data-type="qrcode">
            <i class="fas fa-qrcode me-2"></i>
            <div>
              <strong>QR Code</strong>
              <small class="d-block text-muted">Código QR dinâmico</small>
            </div>
          </div>
        </div>

        <!-- Variáveis dinâmicas -->
        <div class="element-category">
          <div class="category-title">Variáveis Dinâmicas</div>
          
          <div class="element-item" data-type="variable">
            <i class="fas fa-tag me-2"></i>
            <div>
              <strong>Variável Personalizada</strong>
              <small class="d-block text-muted">Adicionar variável customizada</small>
            </div>
          </div>
          
          <div id="dynamicVariables">
            <!-- Variáveis serão carregadas dinamicamente -->
          </div>
          
          <button type="button" class="btn btn-outline-primary btn-sm w-100 mt-2" data-bs-toggle="modal" data-bs-target="#newVariableModal">
            <i class="fas fa-plus me-1"></i> Nova Variável
          </button>
        </div>
      </div>
    </div>

    <!-- Canvas principal -->
    <div class="canvas-container">
      <div class="canvas-wrapper">
        <div id="canvas" class="landscape">
          <!-- Elementos serão adicionados aqui dinamicamente -->
        </div>
      </div>
    </div>

    <!-- Painel de propriedades -->
    <div class="properties-panel">
      <div class="properties-header">
        <i class="fas fa-cog me-2"></i>
        Propriedades
      </div>
      
      <div class="properties-content" id="propertiesPanel" style="display: none;">
        <!-- Propriedades de texto -->
        <div class="property-section" id="textProperties" style="display: none;">
          <div class="property-group">
            <h6>Conteúdo</h6>
            <div class="form-group">
              <label class="form-label">Texto</label>
              <textarea class="form-control" id="elementText" rows="3" placeholder="Digite o texto..."></textarea>
            </div>
          </div>
          
          <div class="property-group">
            <h6>Formatação</h6>
            <div class="form-group">
              <label class="form-label">Fonte</label>
              <select class="form-select" id="fontFamily">
                <option value="Arial">Arial</option>
                <option value="Times New Roman">Times New Roman</option>
                <option value="Helvetica">Helvetica</option>
                <option value="Georgia">Georgia</option>
                <option value="Verdana">Verdana</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">Tamanho</label>
              <div class="input-group">
                <input type="range" class="form-range" id="fontSize" min="8" max="72" value="16">
                <span class="range-value" id="fontSizeValue">16px</span>
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label">Peso</label>
              <select class="form-select" id="fontWeight">
                <option value="normal">Normal</option>
                <option value="bold">Negrito</option>
                <option value="lighter">Mais Leve</option>
                <option value="bolder">Mais Pesado</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">Alinhamento</label>
              <select class="form-select" id="textAlign">
                <option value="left">Esquerda</option>
                <option value="center">Centro</option>
                <option value="right">Direita</option>
                <option value="justify">Justificado</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">Cor</label>
              <input type="color" class="form-control form-control-color" id="textColor" value="#000000">
            </div>
          </div>
        </div>

        <!-- Propriedades de logo -->
        <div class="property-section" id="logoProperties" style="display: none;">
          <div class="property-group">
            <h6>Imagem</h6>
            <div class="form-group">
              <label class="form-label">URL da Imagem</label>
              <input type="url" class="form-control" id="logoUrl" placeholder="https://exemplo.com/logo.png">
            </div>
            
            <div class="form-group">
              <label class="form-label">Tamanho</label>
              <select class="form-select" id="logoSize">
                <option value="small">Pequeno (100px)</option>
                <option value="medium">Médio (150px)</option>
                <option value="large">Grande (200px)</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Propriedades de borda -->
        <div class="property-section" id="borderProperties" style="display: none;">
          <div class="property-group">
            <h6>Borda</h6>
            <div class="form-group">
              <label class="form-label">Largura</label>
              <div class="input-group">
                <input type="range" class="form-range" id="borderWidth" min="0" max="10" value="1">
                <span class="range-value" id="borderWidthValue">1px</span>
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label">Estilo</label>
              <select class="form-select" id="borderStyle">
                <option value="solid">Sólida</option>
                <option value="dashed">Tracejada</option>
                <option value="dotted">Pontilhada</option>
                <option value="double">Dupla</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">Cor</label>
              <input type="color" class="form-control form-control-color" id="borderColor" value="#000000">
            </div>
          </div>
        </div>

        <!-- Propriedades de assinatura -->
        <div class="property-section" id="signatureProperties" style="display: none;">
          <div class="property-group">
            <h6>Assinatura</h6>
            <div class="form-group">
              <label class="form-label">Texto da Assinatura</label>
              <input type="text" class="form-control" id="signatureText" placeholder="Nome do responsável">
            </div>
          </div>
        </div>

        <!-- Propriedades de QR Code -->
        <div class="property-section" id="qrcodeProperties" style="display: none;">
          <div class="property-group">
            <h6>QR Code</h6>
            <div class="form-group">
              <label class="form-label">Conteúdo</label>
              <input type="text" class="form-control" id="qrCodeContent" placeholder="URL ou texto para o QR Code">
            </div>
            
            <div class="form-group">
              <label class="form-label">Tamanho</label>
              <select class="form-select" id="qrCodeSize">
                <option value="small">Pequeno (100px)</option>
                <option value="medium">Médio (150px)</option>
                <option value="large">Grande (200px)</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Propriedades de variável personalizada -->
        <div class="property-section" id="variableProperties" style="display: none;">
          <div class="property-group">
            <h6>Variável</h6>
            <div class="form-group">
              <label class="form-label">Variável</label>
              <select class="form-select" id="customVariableSelect">
                <option value="">Selecione uma variável</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">Formato</label>
              <select class="form-select" id="customVariableFormat">
                <option value="text">Texto</option>
                <option value="date">Data</option>
                <option value="number">Número</option>
                <option value="currency">Moeda</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">Valor Padrão</label>
              <input type="text" class="form-control" id="customVariableDefault" placeholder="Valor padrão (opcional)">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Área de operações do template -->
  <div class="template-operations">
    <div class="template-info">
      <div class="form-group">
        <label for="templateName">Nome do Template</label>
        <input type="text" class="form-control" id="templateName" placeholder="Digite o nome do template" value="Novo Template">
      </div>
      
      <div class="form-group">
        <label for="templateOrientation">Orientação</label>
        <select class="form-select" id="templateOrientation">
          <option value="landscape">Paisagem</option>
          <option value="portrait">Retrato</option>
        </select>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Preview -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="previewModalLabel">
          <i class="fas fa-eye me-2"></i>
          Preview do Certificado
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="previewContent">
          <!-- Conteúdo do preview será inserido aqui -->
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        <button type="button" class="btn btn-primary">
          <i class="fas fa-print me-1"></i> Imprimir
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Nova Variável -->
<div class="modal fade" id="newVariableModal" tabindex="-1" aria-labelledby="newVariableModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="newVariableModalLabel">
          <i class="fas fa-plus me-2"></i>
          Nova Variável
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="newVariableName" class="form-label">Nome da Variável</label>
          <input type="text" class="form-control" id="newVariableName" placeholder="Ex: NOME_PARTICIPANTE">
          <small class="form-text text-muted">Use apenas letras maiúsculas, números e underscore</small>
        </div>
        
        <div class="form-group">
          <label for="newVariableDescription" class="form-label">Descrição</label>
          <input type="text" class="form-control" id="newVariableDescription" placeholder="Ex: Nome do participante">
        </div>
        
        <div class="form-group">
          <label for="newVariableType" class="form-label">Tipo</label>
          <select class="form-select" id="newVariableType">
            <option value="text">Texto</option>
            <option value="date">Data</option>
            <option value="number">Número</option>
            <option value="list">Lista</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="newVariableDefault" class="form-label">Valor Padrão (opcional)</label>
          <input type="text" class="form-control" id="newVariableDefault" placeholder="Valor padrão">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="saveNewVariable">
          <i class="fas fa-save me-1"></i> Salvar Variável
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts_extra %}
<script src="{{ url_for('static', filename='js/certificate-editor.js') }}"></script>
{% endblock %}