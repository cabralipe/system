{% extends "base.html" %}
{% block title %}Dashboard - Participante{% endblock %}

{% block content %}
<style>
  :root {
    --primary: #4361ee;
    --secondary: #3f37c9;
    --success: #4cc9f0;
    --warning: #f8961e;
    --danger: #f72585;
    --light: #f8f9fa;
    --dark: #212529;
    --gray: #6c757d;
    --future: #7209b7;
    --current: #38b000;
    --past: #f72585;
  }

  body {
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    background-color: #f8fafc;
    color: #1a1a1a;
  }

  .dashboard-header {
    margin: 2rem 0 3rem;
    text-align: center;
    position: relative;
  }

  .dashboard-header h2 {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .events-container {
    display: grid;
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .event-section {
    background: white;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    overflow: hidden;
  }

  .event-header {
    padding: 1.5rem;
    position: relative;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
  }

  .event-header.future {
    border-left: 5px solid var(--future);
  }

  .event-header.current {
    border-left: 5px solid var(--current);
  }

  .event-header.past {
    border-left: 5px solid var(--past);
  }

  .event-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }

  .event-dates {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--gray);
    font-size: 0.9rem;
  }

  .event-badge {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.35rem 0.75rem;
    border-radius: 50px;
  }

  .badge-future {
    background-color: rgba(114, 9, 183, 0.1);
    color: var(--future);
  }

  .badge-current {
    background-color: rgba(56, 176, 0, 0.1);
    color: var(--current);
  }

  .badge-past {
    background-color: rgba(247, 37, 133, 0.1);
    color: var(--past);
  }

  .workshops-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
    padding: 1.5rem;
  }

  .workshop-card {
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(0, 0, 0, 0.05);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .workshop-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  }

  .workshop-header {
    padding: 1rem;
    background-color: rgba(248, 249, 250, 0.7);
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
  }

  .workshop-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
  }

  .workshop-body {
    padding: 1rem;
  }

  .workshop-detail {
    margin-bottom: 0.75rem;
    font-size: 0.9rem;
  }

  .workshop-detail strong {
    color: var(--dark);
    font-weight: 600;
  }

  .workshop-schedule {
    padding-left: 0;
    list-style: none;
    margin: 0.5rem 0;
  }

  .schedule-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    font-size: 0.85rem;
    background-color: rgba(248, 249, 250, 0.5);
    border-radius: 4px;
    margin-bottom: 0.25rem;
  }

  .workshop-footer {
    padding: 1rem;
    border-top: 1px solid rgba(0, 0, 0, 0.05);
  }

  .btn-action {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    width: 100%;
    padding: 0.75rem;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.9rem;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 0.5rem;
  }

  .btn-action i {
    font-size: 1rem;
  }

  .btn-primary {
    background-color: var(--primary);
    color: white;
  }

  .btn-primary:hover {
    background-color: #3a50d9;
  }

  .btn-success {
    background-color: var(--success);
    color: white;
  }

  .btn-success:hover {
    background-color: #3ab4db;
  }

  .btn-warning {
    background-color: var(--warning);
    color: var(--dark);
  }

  .btn-warning:hover {
    background-color: #e57e10;
  }

  .btn-danger {
    background-color: var(--danger);
    color: white;
  }

  .btn-danger:hover {
    background-color: #e31171;
  }

  .btn-info {
    background-color: var(--primary);
    color: white;
  }

  .btn-info:hover {
    background-color: #3a50d9;
  }

  .vacancy-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 500;
  }

  .vacancy-available {
    background-color: rgba(76, 201, 240, 0.1);
    color: var(--success);
  }

  .vacancy-full {
    background-color: rgba(247, 37, 133, 0.1);
    color: var(--danger);
  }

  .alert-message {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem;
    border-radius: 6px;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
  }

  .alert-info {
    background-color: rgba(67, 97, 238, 0.1);
    color: var(--primary);
  }

  .alert-warning {
    background-color: rgba(248, 150, 30, 0.1);
    color: #d17a17;
  }

  .alert-danger {
    background-color: rgba(247, 37, 133, 0.1);
    color: var(--danger);
  }

  .empty-section {
    grid-column: 1 / -1;
    text-align: center;
    padding: 3rem;
    color: var(--gray);
  }
  
  /* Spinner para indicar carregamento */
  .spinner-border {
    display: inline-block;
    width: 1rem;
    height: 1rem;
    vertical-align: text-bottom;
    border: 0.2em solid currentColor;
    border-right-color: transparent;
    border-radius: 50%;
    animation: spinner-border .75s linear infinite;
  }

  @keyframes spinner-border {
    to { transform: rotate(360deg); }
  }
  
  /* Toasts para notificações */
  .toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
    padding: 1rem;
    border-radius: 6px;
    background-color: white;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    max-width: 350px;
    animation: fadeIn 0.3s ease-in-out;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  /* Botões adicionais */
  .action-buttons {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 2rem;
  }
  
  .action-button {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.9rem;
    text-decoration: none;
    color: white;
    background-color: var(--primary);
    transition: all 0.2s;
  }
  
  .action-button:hover {
    background-color: #3a50d9;
    color: white;
    text-decoration: none;
  }
  
  .action-button.secondary {
    background-color: var(--success);
  }
  
  .action-button.secondary:hover {
    background-color: #3ab4db;
  }

  @media (max-width: 768px) {
    .workshops-grid {
      grid-template-columns: 1fr;
    }
    
    .dashboard-header h2 {
      font-size: 2rem;
    }
    
    .action-buttons {
      flex-direction: column;
      gap: 0.5rem;
      align-items: stretch;
    }
  }
</style>

<div class="container">
  <div class="dashboard-header">
    <h2>Bem-vindo(a), {{ usuario.nome }}</h2>
    {% if usuario.tipo_inscricao %}
      <div class="alert-message alert-info" style="max-width: 800px; margin: 0 auto;">
        <i class="fas fa-info-circle"></i>
        <div>
          <strong>Tipo de inscrição:</strong> {{ usuario.tipo_inscricao.nome }}
          {% set regra = usuario.tipo_inscricao.regras|first %}
          {% if regra and regra.limite_oficinas > 0 %}
            <br>
            Você pode se inscrever em até <strong>{{ regra.limite_oficinas }}</strong> oficinas
            ({{ usuario.inscricoes|length }} de {{ regra.limite_oficinas }} utilizadas)
          {% endif %}
        </div>
      </div>
    {% endif %}
  </div>
  
  <!-- Avisos e ações principais
  {% if current_user.tem_pagamento_pendente() %}
    <div class="alert-message alert-warning" style="max-width: 800px; margin: 0 auto 2rem auto;">
      <i class="fas fa-exclamation-triangle"></i>
      <div>Seu pagamento ainda não foi confirmado. Enquanto isso você só pode visualizar o sistema.</div>
    </div>
  {% endif %} -->
  
  <div class="action-buttons">
    <!-- Formulários disponíveis -->
    {% if formularios_disponiveis %}
      <a href="{{ url_for('routes.listar_formularios_participante') }}" class="action-button">
        <i class="fas fa-clipboard-list"></i> Acessar Formulários
      </a>
    {% endif %}
    
    <!-- QR Code do Evento -->
    {% if config_cliente and config_cliente.habilitar_qrcode_evento_credenciamento %}
      <a href="{{ url_for('routes.gerar_evento_qrcode_pdf', evento_id=evento_id) }}" class="action-button">
        <i class="fas fa-qrcode"></i> Baixar QR Code do Evento
      </a>
    {% endif %}
    
    <!-- Submissão de Trabalhos -->
    {% if config_cliente and config_cliente.habilitar_submissao_trabalhos %}
      <a href="{{ url_for('routes.nova_submissao') }}" class="action-button secondary">
        <i class="fas fa-upload"></i> Submeter Trabalho
      </a>
    {% endif %}
  </div>

  <!-- Eventos Futuros -->
  <div class="events-container">
    <h2 class="dashboard-header">Eventos Futuros</h2>
    
    {% if eventos_futuros %}
      {% for evento in eventos_futuros %}
        <div class="event-section">
          <div class="event-header future">
            <h3 class="event-title">{{ evento.nome }}</h3>
            <div class="event-dates">
              <i class="far fa-calendar-alt"></i>
              {{ evento.data_inicio.strftime('%d/%m/%Y') if evento.data_inicio else 'Data não informada' }} - {{ evento.data_fim.strftime('%d/%m/%Y') if evento.data_fim else 'Data não informada' }}
            </div>
            <span class="event-badge badge-future">Futuro</span>
          </div>
          
          <div class="workshops-grid">
            {% for oficina in evento.oficinas %}
              <div class="workshop-card" data-oficina-id="{{ oficina.id }}">
                <div class="workshop-header">
                  <h4 class="workshop-title">{{ oficina.titulo }}</h4>
                </div>
                
                <div class="workshop-body">
                  <div class="workshop-detail">
                    <strong>Descrição:</strong> {{ oficina.descricao }}
                  </div>
                  
                  <div class="workshop-detail">
                    <strong>Ministrantes:</strong> 
                    {{ oficina.ministrantes|join(', ') if oficina.ministrantes else 'A definir' }}
                  </div>
                  
                  <div class="workshop-detail">
                    <strong>Datas:</strong>
                    <ul class="workshop-schedule">
                      {% for dia in oficina.dias %}
                        <li class="schedule-item">
                          <i class="far fa-calendar-alt"></i>
                          {{ dia.data.strftime('%d/%m/%Y') }} 
                          <i class="far fa-clock"></i>
                          {{ dia.horario_inicio }} - {{ dia.horario_fim }}
                        </li>
                      {% endfor %}
                    </ul>
                  </div>
                  
                  {% if oficina.carga_horaria %}
                  <div class="workshop-detail">
                    <strong>Carga Horária:</strong> {{ oficina.carga_horaria }} horas
                  </div>
                  {% endif %}
                  
                  {% if oficina.tipo_inscricao == 'com_inscricao_com_limite' %}
                  <div class="workshop-detail">
                    <strong>Vagas:</strong>
                    <span class="vacancy-{% if oficina.vagas > 0 %}available{% else %}full{% endif %}">
                      <i class="fas fa-{% if oficina.vagas > 0 %}check-circle{% else %}times-circle{% endif %}"></i>
                      {% if oficina.vagas > 0 %}
                        <span class="info-vagas">{{ oficina.vagas }}</span> disponíveis
                      {% else %}
                        Esgotado
                      {% endif %}
                    </span>
                  </div>
                  {% endif %}
                </div>
                
                <div class="workshop-footer">
                  {% if oficina.id in inscricoes_ids|default([]) %}
                    <a href="{{ url_for('routes.baixar_comprovante', oficina_id=oficina.id) }}" class="btn-action btn-primary">
                      <i class="fas fa-file-download"></i> Comprovante
                    </a>
                    <form action="{{ url_for('routes.remover_inscricao', oficina_id=oficina.id) }}" method="post">
                      <button type="submit" class="btn-action btn-danger">
                        <i class="fas fa-times-circle"></i> Cancelar Inscrição
                      </button>
                    </form>
                  {% elif oficina.tipo_inscricao == 'sem_inscricao' %}
                    <div class="alert-message alert-info">
                      <i class="fas fa-info-circle"></i> Não requer inscrição
                    </div>
                  {% elif oficina.vagas > 0 and oficina.disponivel_para_inscricao %}
                    <button onclick="inscrever('{{ oficina.id }}')" class="btn-action btn-success">
                      <i class="fas fa-check-circle"></i> Inscrever-se
                    </button>
                  {% elif not oficina.disponivel_para_inscricao %}
                    <div class="alert-message alert-warning">
                      <i class="fas fa-exclamation-triangle"></i> {{ oficina.motivo_indisponibilidade }}
                    </div>
                  {% else %}
                    <button onclick="inscrever('{{ oficina.id }}')" class="btn-action btn-success">
                      <i class="fas fa-check-circle"></i> Inscrever-se
                    </button>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="empty-section">
        <i class="fas fa-calendar-plus fa-2x"></i>
        <p>Nenhum evento futuro agendado</p>
      </div>
    {% endif %}
  </div>

  <!-- Eventos Atuais -->
  <div class="events-container">
    <h2 class="dashboard-header">Eventos em Andamento</h2>
    
    {% if eventos_atuais %}
      {% for evento in eventos_atuais %}
        <div class="event-section">
          <div class="event-header current">
            <h3 class="event-title">{{ evento.nome }}</h3>
            <div class="event-dates">
              <i class="far fa-calendar-alt"></i>
              {{ evento.data_inicio.strftime('%d/%m/%Y') if evento.data_inicio else 'Data não informada' }} - {{ evento.data_fim.strftime('%d/%m/%Y') if evento.data_fim else 'Data não informada' }}
            </div>
            <span class="event-badge badge-current">Em Andamento</span>
          </div>
          
          <div class="workshops-grid">
            {% for oficina in evento.oficinas %}
              <div class="workshop-card" data-oficina-id="{{ oficina.id }}">
                <div class="workshop-header">
                  <h4 class="workshop-title">{{ oficina.titulo }}</h4>
                </div>
                
                <div class="workshop-body">
                  <div class="workshop-detail">
                    <strong>Descrição:</strong> {{ oficina.descricao }}
                  </div>
                  
                  <div class="workshop-detail">
                    <strong>Ministrantes:</strong> 
                    {{ oficina.ministrantes|join(', ') if oficina.ministrantes else 'A definir' }}
                  </div>
                  
                  <div class="workshop-detail">
                    <strong>Datas:</strong>
                    <ul class="workshop-schedule">
                      {% for dia in oficina.dias %}
                        <li class="schedule-item">
                          <i class="far fa-calendar-alt"></i>
                          {{ dia.data.strftime('%d/%m/%Y') }} 
                          <i class="far fa-clock"></i>
                          {{ dia.horario_inicio }} - {{ dia.horario_fim }}
                        </li>
                      {% endfor %}
                    </ul>
                  </div>
                  
                  {% if oficina.carga_horaria %}
                  <div class="workshop-detail">
                    <strong>Carga Horária:</strong> {{ oficina.carga_horaria }} horas
                  </div>
                  {% endif %}
                  
                  {% if oficina.tipo_inscricao == 'com_inscricao_com_limite' %}
                  <div class="workshop-detail">
                    <strong>Vagas:</strong>
                    <span class="vacancy-{% if oficina.vagas > 0 %}available{% else %}full{% endif %}">
                      <i class="fas fa-{% if oficina.vagas > 0 %}check-circle{% else %}times-circle{% endif %}"></i>
                      {% if oficina.vagas > 0 %}
                        <span class="info-vagas">{{ oficina.vagas }}</span> disponíveis
                      {% else %}
                        Esgotado
                      {% endif %}
                    </span>
                  </div>
                  {% endif %}
                </div>
                
                <div class="workshop-footer">
                  {% if oficina.id in inscricoes_ids|default([]) %}
                    {% if permitir_checkin_global %}
                    <a href="{{ url_for('routes.checkin', oficina_id=oficina.id) }}" 
                       class="btn-action btn-warning">
                      <i class="fas fa-clipboard-check"></i> Fazer Check-in
                    </a>
                    {% endif %}
                    
                    <a href="{{ url_for('routes.baixar_comprovante', oficina_id=oficina.id) }}" 
                       class="btn-action btn-primary">
                      <i class="fas fa-file-download"></i> Comprovante
                    </a>
                    
                    <form action="{{ url_for('routes.remover_inscricao', oficina_id=oficina.id) }}" method="post">
                      <button type="submit" class="btn-action btn-danger">
                        <i class="fas fa-times-circle"></i> Cancelar Inscrição
                      </button>
                    </form>
                    
                    {% if habilitar_certificado_individual %}
                    <a href="{{ url_for('routes.gerar_certificado_individual', oficina_id=oficina.id) }}"
                       class="btn-action btn-success">
                      <i class="fas fa-certificate"></i> Certificado
                    </a>
                    {% endif %}
                    
                    {% if habilitar_feedback %}
                    <a href="{{ url_for('routes.feedback', oficina_id=oficina.id) }}"
                       class="btn-action btn-info">
                      <i class="fas fa-comment-alt"></i> Feedback
                    </a>
                    {% endif %}
                  {% elif oficina.tipo_inscricao == 'sem_inscricao' %}
                    <div class="alert-message alert-info">
                      <i class="fas fa-info-circle"></i> Participação livre
                    </div>
                  {% elif oficina.vagas > 0 %}
                    <button onclick="inscrever('{{ oficina.id }}')" 
                            class="btn-action btn-success">
                      <i class="fas fa-check-circle"></i> Inscrever-se
                    </button>
                  {% elif not oficina.disponivel_para_inscricao %}
                    <div class="alert-message alert-warning">
                      <i class="fas fa-exclamation-triangle"></i> 
                      {{ oficina.motivo_indisponibilidade }}
                    </div>
                  {% else %}
                    <button onclick="inscrever('{{ oficina.id }}')" 
                            class="btn-action btn-success">
                      <i class="fas fa-check-circle"></i> Inscrever-se
                    </button>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="empty-section">
        <i class="fas fa-calendar-day fa-2x"></i>
        <p>Nenhum evento em andamento</p>
      </div>
    {% endif %}
  </div>

  <!-- Eventos Encerrados -->
  <div class="events-container">
    <h2 class="dashboard-header">Eventos Encerrados</h2>
    
    {% if eventos_encerrados %}
      {% for evento in eventos_encerrados %}
        <div class="event-section">
          <div class="event-header past">
            <h3 class="event-title">{{ evento.nome }}</h3>
            <div class="event-dates">
              <i class="far fa-calendar-alt"></i>
              {{ evento.data_inicio.strftime('%d/%m/%Y') if evento.data_inicio else 'Data não informada' }} - {{ evento.data_fim.strftime('%d/%m/%Y') if evento.data_fim else 'Data não informada' }}
            </div>
            <span class="event-badge badge-past">Encerrado</span>
          </div>
          
          <div class="workshops-grid">
            {% for oficina in evento.oficinas %}
              <div class="workshop-card" data-oficina-id="{{ oficina.id }}">
                <div class="workshop-header">
                  <h4 class="workshop-title">{{ oficina.titulo }}</h4>
                </div>
                
                <div class="workshop-body">
                  <div class="workshop-detail">
                    <strong>Descrição:</strong> {{ oficina.descricao }}
                  </div>
                  
                  <div class="workshop-detail">
                    <strong>Ministrantes:</strong> 
                    {{ oficina.ministrantes|join(', ') if oficina.ministrantes else 'A definir' }}
                  </div>
                  
                  <div class="workshop-detail">
                    <strong>Datas realizadas:</strong>
                    <ul class="workshop-schedule">
                      {% for dia in oficina.dias %}
                        <li class="schedule-item">
                          <i class="far fa-calendar-alt"></i>
                          {{ dia.data.strftime('%d/%m/%Y') }} 
                          <i class="far fa-clock"></i>
                          {{ dia.horario_inicio }} - {{ dia.horario_fim }}
                        </li>
                      {% endfor %}
                    </ul>
                  </div>
                  
                  {% if oficina.carga_horaria %}
                  <div class="workshop-detail">
                    <strong>Carga Horária:</strong> {{ oficina.carga_horaria }} horas
                  </div>
                  {% endif %}
                </div>
                
                <div class="workshop-footer">
                  {% if oficina.id in inscricoes_ids|default([]) %}
                    <a href="{{ url_for('routes.baixar_comprovante', oficina_id=oficina.id) }}" 
                       class="btn-action btn-primary">
                      <i class="fas fa-file-download"></i> Comprovante
                    </a>
                    
                    {% if habilitar_certificado_individual %}
                    <a href="{{ url_for('routes.gerar_certificado_individual', oficina_id=oficina.id) }}"
                       class="btn-action btn-success">
                      <i class="fas fa-certificate"></i> Certificado
                    </a>
                    {% endif %}
                    
                    {% if habilitar_feedback %}
                    <a href="{{ url_for('routes.feedback', oficina_id=oficina.id) }}"
                       class="btn-action btn-info">
                      <i class="fas fa-comment-alt"></i> Feedback
                    </a>
                    {% endif %}
                  {% else %}
                    <div class="alert-message alert-info">
                      <i class="fas fa-info-circle"></i> Evento encerrado
                    </div>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="empty-section">
        <i class="fas fa-calendar-check fa-2x"></i>
        <p>Nenhum evento encerrado</p>
      </div>
    {% endif %}
  </div>
</div>

<script>
// Função para lidar com a inscrição em oficinas
function inscrever(oficinaId) {
    // Encontra o card da oficina pelo ID
    let oficinaCard = document.querySelector(`[data-oficina-id="${oficinaId}"]`);
    if (!oficinaCard) return;
    
    // Atualiza imediatamente o número de vagas
    let vagasElement = oficinaCard.querySelector(".info-vagas");
    if (vagasElement) {
        let vagasAtualizadas = parseInt(vagasElement.innerText) - 1;
        vagasElement.innerText = vagasAtualizadas;
        
        // Atualiza o badge de vagas
        let badgeElement = vagasElement.nextElementSibling;
        if (badgeElement) {
            if (vagasAtualizadas === 0) {
                badgeElement.className = "status-badge badge-esgotado";
                badgeElement.innerText = "Esgotado";
            } else {
                badgeElement.innerText = vagasAtualizadas + " disponíveis";
            }
        }
    }
    
    // Remove o botão de inscrição e prepara área para novos botões
    let cardFooter = oficinaCard.querySelector(".card-footer") || oficinaCard.querySelector(".workshop-footer");
    if (cardFooter) {
        cardFooter.innerHTML = '<div class="d-flex flex-column gap-2"></div>';
        let buttonContainer = cardFooter.querySelector(".d-flex");
        
        // Adiciona o botão de cancelar inscrição
        let cancelForm = document.createElement("form");
        cancelForm.setAttribute("action", `/remover_inscricao/${oficinaId}`);
        cancelForm.setAttribute("method", "post");
        cancelForm.innerHTML = `
            <button type="submit" class="btn btn-danger w-100">
                <i class="fas fa-times-circle"></i> Cancelar Inscrição
            </button>
        `;
        buttonContainer.appendChild(cancelForm);
        
        // Adiciona botão de check-in se permitido globalmente
        if ('{{ permitir_checkin_global }}' === 'True') {
            let checkinBtn = document.createElement("a");
            checkinBtn.setAttribute("href", `/checkin/${oficinaId}`);
            checkinBtn.className = "btn btn-warning w-100";
            checkinBtn.innerHTML = '<i class="fas fa-clipboard-check"></i> Realizar Check-in';
            buttonContainer.appendChild(checkinBtn);
        }
    }
    
    // Envia requisição ao servidor para registrar a inscrição
    fetch(`/inscrever/${oficinaId}`, {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            let buttonContainer = oficinaCard.querySelector(".card-footer .d-flex") 
                                  || oficinaCard.querySelector(".workshop-footer .d-flex");
            // Adiciona o botão para baixar comprovante
            let comprovanteBtn = document.createElement("a");
            comprovanteBtn.setAttribute("href", data.pdf_url);
            comprovanteBtn.className = "btn btn-primary w-100";
            comprovanteBtn.innerHTML = '<i class="fas fa-file-download"></i> Baixar Comprovante';
            buttonContainer.appendChild(comprovanteBtn);
            
            // Exibe notificação de sucesso (toast) com Bootstrap 5
            let toast = document.createElement("div");
            toast.className = "toast align-items-center text-white bg-success border-0 position-fixed bottom-0 end-0 m-3";
            toast.setAttribute("role", "alert");
            toast.setAttribute("aria-live", "assertive");
            toast.setAttribute("aria-atomic", "true");
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="fas fa-check-circle"></i> Inscrição realizada com sucesso!
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;
            document.body.appendChild(toast);
            let bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            setTimeout(() => toast.remove(), 5000);
        } else {
            alert(data.message);
            location.reload();
        }
    })
    .catch(error => {
        console.error('Erro:', error);
        location.reload();
    });
}

// Função para criar notificações visuais
function criarNotificacao(tipo, mensagem) {
    // Cria elemento de notificação
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.style.backgroundColor = tipo === 'success' 
        ? 'rgba(56, 176, 0, 0.1)' // Verde para sucesso
        : 'rgba(247, 37, 133, 0.1)'; // Vermelho para erro
    
    // Define o conteúdo
    toast.innerHTML = `
        <div class="alert-message alert-${tipo === 'success' ? 'info' : 'danger'}" style="margin-bottom: 0;">
            <i class="fas fa-${tipo === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
            ${mensagem}
        </div>
    `;
    
    // Adiciona ao corpo do documento
    document.body.appendChild(toast);
    
    // Remove após 3 segundos
    setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(10px)';
        toast.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
        
        // Remove do DOM após a transição
        setTimeout(() => {
            toast.remove();
        }, 300);
    }, 3000);
}

// Função para verificar se o usuário pode se inscrever em mais oficinas
function verificarLimiteInscricoes() {
    // Esta função pode ser chamada para verificar se o usuário atingiu o limite
    // de inscrições antes de mostrar o botão de inscrição
    const regra = document.querySelector('[data-limite-oficinas]');
    if (!regra) return true;
    
    const limite = parseInt(regra.getAttribute('data-limite-oficinas'));
    const utilizadas = parseInt(regra.getAttribute('data-inscricoes-utilizadas'));
    
    return utilizadas < limite;
}

// Inicialização quando o documento estiver pronto
document.addEventListener('DOMContentLoaded', function() {
    // Adiciona atributos data para o limite de inscrições
    const regraElement = document.querySelector('.alert-message.alert-info strong');
    if (regraElement && regraElement.textContent.includes('oficinas')) {
        const textContent = regraElement.parentElement.textContent;
        const match = textContent.match(/(\d+) de (\d+) utilizadas/);
        
        if (match && match.length === 3) {
            const inscricoesUtilizadas = parseInt(match[1]);
            const limiteOficinas = parseInt(match[2]);
            
            document.body.setAttribute('data-inscricoes-utilizadas', inscricoesUtilizadas);
            document.body.setAttribute('data-limite-oficinas', limiteOficinas);
        }
    }
    
    // Inicializa qualquer comportamento adicional
    console.log('Dashboard de participante inicializado com sucesso!');
});
</script>
{% endblock %}